!function(a,b,c){"function"==typeof define&&define.amd&&define("keen",[],function(){return c()}),"object"==typeof module&&"object"==typeof module.exports?module.exports=c():b[a]=c()}("Keen",this,function(){"use strict";function Keen(){return _init.apply(this,arguments)}function _init(a){if(_isUndefined(a))throw new Error("Check out our JavaScript SDK Usage Guide: https://keen.io/docs/clients/javascript/usage-guide/");if(_isUndefined(a.projectId)||"String"!==_type(a.projectId)||a.projectId.length<1)throw new Error("Please provide a projectId");this.configure(a)}function _extend(a){for(var b=1;b<arguments.length;b++)for(var c in arguments[b])a[c]=arguments[b][c];return a}function _isUndefined(a){return void 0===a}function _type(a){var b,c;return b=a&&a.constructor?a.constructor.toString():void 0,b&&(c=b.split("(")[0].split(/function\s*/),c.length>0)?c[1]:"Null"}function _each(a,b,c){var d;if(!a)return 0;if(c=c?c:a,"array"===_type(a)){for(d=0;d<a.length;d++)if(b.call(c,a[d],d,a)===!1)return 0}else for(d in a)if(a.hasOwnProperty(d)&&b.call(c,a[d],d,a)===!1)return 0;return 1}function _once(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}}function _parse_params(a){for(var b,c={},d=/\+/g,e=/([^&=]+)=?([^&]*)/g,f=function(a){return decodeURIComponent(a.replace(d," "))},g=a.split("?")[1];b=e.exec(g);)c[f(b[1])]=f(b[2]);return c}function _set_protocol(a){switch(a){case"http":return"http";case"auto":return location.protocol.replace(/:/g,"");case"https":case void 0:default:return"https"}}function _set_request_type(a){var b=a||"jsonp",c=!1;return("Object"===_type(XMLHttpRequest)||"Function"===_type(XMLHttpRequest))&&"withCredentials"in new XMLHttpRequest&&(c=!0,Keen.canXHR=!0),null==b||"xhr"==b?c?"xhr":"jsonp":b}function _build_url(a){return this.client.endpoint+"/projects/"+this.client.projectId+a}function _sendXhr(a,b,c,d,e,f){var g,h,i=["MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],j=e,k=f;if(e=null,f=null,window.XMLHttpRequest)h=new XMLHttpRequest;else for(var l=0;l<i.length;l++)try{h=new ActiveXObject(i[l]);break}catch(m){}h.onreadystatechange=function(){var a;if(4==h.readyState)if(h.status>=200&&h.status<300){try{a=JSON.parse(h.responseText)}catch(b){Keen.log("Could not parse HTTP response: "+h.responseText),k&&(k(h,b),j=k=null)}j&&a&&(j(a),j=k=null)}else Keen.log("HTTP request failed."),k&&(k(h,null),j=k=null)},h.open(a,b,!0),_each(c,function(a,b){h.setRequestHeader(b,a)}),d&&(g=JSON.stringify(d)),a&&"GET"===a.toUpperCase()?h.send():a&&"POST"===a.toUpperCase()&&h.send(g)}function _sendJsonp(a,b,c,d){var e=(new Date).getTime(),f=c,g=d,h=document.createElement("script"),i=document.getElementsByTagName("head")[0],j="keenJSONPCallback",k="keen-jsonp",l=!1;for(c=null,d=null,j+=e,k+=e;j in window;)j+="a";window[j]=function(a){l=!0,f&&a&&f(a),i.removeChild(h),delete window[j],f=g=null},h.id=k,h.src=a+"&jsonp="+j,i.appendChild(h),h.onreadystatechange=function(){l===!1&&"loaded"===this.readyState&&(l=!0,g&&(g(),f=g=null))},h.onerror=function(){l===!1&&(l=!0,g&&(g(),f=g=null))}}function _sendBeacon(a,b,c,d){var e=c,f=d,g=!1,h=document.createElement("img");c=null,d=null,h.onload=function(){if(g=!0,"naturalHeight"in this){if(this.naturalHeight+this.naturalWidth===0)return void this.onerror()}else if(this.width+this.height===0)return void this.onerror();e&&(e({created:!0}),e=f=null)},h.onerror=function(){g=!0,f&&(f(),e=f=null)},h.src=a+"&c=clv1"}function _uploadEvent(a,b,c,d){var e=_build_url.call(this,"/events/"+a),f="",g=this.client.requestType,h={};return this.client.globalProperties&&(h=this.client.globalProperties(a)),_each(b,function(a,b){h[b]=a}),"xhr"!==g&&(f+="?api_key="+encodeURIComponent(this.client.writeKey),f+="&data="+encodeURIComponent(Keen.Base64.encode(JSON.stringify(h))),f+="&modified="+encodeURIComponent((new Date).getTime()),String(e+f).length<Keen.urlMaxLength)?void("jsonp"===g?_sendJsonp(e+f,null,c,d):_sendBeacon(e+f,null,c,d)):void(Keen.canXHR?_sendXhr("POST",e,{Authorization:this.client.writeKey,"Content-Type":"application/json"},h,c,d):Keen.log("Event not sent: URL length exceeds current browser limit, and XHR (POST) is not supported."))}function _getTimezoneOffset(){return-60*(new Date).getTimezoneOffset()}function _getQueryString(a){var b=[];for(var c in a)if(a[c]){var d=a[c];"[object String]"!==Object.prototype.toString.call(d)&&(d=JSON.stringify(d)),d=encodeURIComponent(d),b.push(c+"="+d)}return"&"+b.join("&")}function _sendQuery(a,b,c,d){var e=a,f="",g=this.client.requestType,h=c,i=d;return c=null,d=null,e.indexOf("extraction")>-1&&(g="xhr"),f+="?api_key="+this.client.readKey,f+=_getQueryString.call(this,b),"xhr"!==g&&String(e+f).length<Keen.urlMaxLength?void _sendJsonp(e+f,null,h,i):(Keen.canXHR?_sendXhr("GET",e+f,null,null,h,i):Keen.log("Event not sent: URL length exceeds current browser limit, and XHR (POST) is not supported."),void(h=i=null))}function _build_visual(a,b){this.visual&&this.visual.trigger("remove"),this.visual=new Keen.Visualization(this,a,b)}function _transform(a,b){var c,d=this,e=b||{};if("number"==typeof a.result&&(e={collection:"",select:[{path:"result",type:"string",label:"Metric",format:!1,method:"Keen.utils.prettyNumber",replace:{"null":0}}]}),a.result instanceof Array&&a.result.length>0){if(!a.result[0].timeframe||"number"!=typeof a.result[0].value&&null!=a.result[0].value||(e={collection:"result",select:[{path:"timeframe -> start",type:"date"},{path:"value",type:"number",format:"10",replace:{"null":0}}],sort:{column:0,order:"asc"}}),"number"==typeof a.result[0].result){e={collection:"result",select:[],sort:{column:1,order:"desc"}};for(var f in a.result[0])if(a.result[0].hasOwnProperty(f)&&"result"!==f){e.select.push({path:f,type:"string"});break}e.select.push({path:"result",type:"number"})}if(a.result[0].value instanceof Array){e={collection:"result",unpack:{index:{path:"timeframe -> start",type:"date"},value:{path:"value -> result",type:"number",replace:{"null":0}}},sort:{value:"desc"}};for(var f in a.result[0].value[0])if(a.result[0].value[0].hasOwnProperty(f)&&"result"!==f){e.unpack.label={path:"value -> "+f,type:"string"};break}}"number"==typeof a.result[0]&&(e={collection:"",unpack:{index:{path:"steps -> event_collection",type:"string"},value:{path:"result -> ",type:"number"}}})}return d.colorMapping&&_each(d.colorMapping,function(a,b){d.colorMapping[b]=a.trim()}),d.labelMapping&&"Object"==_type(d.labelMapping)&&(e.unpack&&(e.unpack.index&&(e.unpack.index.replace=e.unpack.index.replace||d.labelMapping),e.unpack.label&&(e.unpack.label.replace=e.unpack.label.replace||d.labelMapping)),e.select&&_each(e.select,function(a,b){e.select[b].replace=d.labelMapping})),c=new Keen.Dataform(a,e),d.labelMapping&&"Array"==_type(d.labelMapping)&&(e.unpack&&2==c.table[0].length&&_each(c.table,function(a,b){b>0&&d.labelMapping[b-1]&&(c.table[b][0]=d.labelMapping[b-1])}),e.unpack&&c.table[0].length>2&&_each(c.table[0],function(a,b){b>0&&d.labelMapping[b-1]&&(c.table[0][b]=d.labelMapping[b-1])})),c}function _pretty_number(a){function b(a,c){var a=String(a),d=a.split(".");if(d.length>1){a=d[0];var e=d[1];2==a.length&&e.length>0?e.length>0?a=a+"."+e.charAt(0):a+="0":1==a.length&&e.length>0&&(a=a+"."+e.charAt(0),a+=e.length>1?e.charAt(1):"0")}var g=a.length;return a.split(".").length>1&&g--,3>=g?String(a)+f[c]:b(Number(a)/1e3,c+1)}var c=Number(a),d=c.toPrecision(3),e="",f=["","k","M","B","T"];return Number(d)==c&&String(c).length<=4?String(c):c>=1||-1>=c?(0>c&&(c=-c,e="-"),e+b(c,0)):c.toPrecision(3)}function _load_script(a,b){var c,d=document,e=d.head||d.getElementsByTagName("head");setTimeout(function(){if("item"in e){if(!e[0])return void setTimeout(arguments.callee,25);e=e[0]}var c=d.createElement("script"),f=!1;c.onload=c.onreadystatechange=function(){return c.readyState&&"complete"!==c.readyState&&"loaded"!==c.readyState||f?!1:(c.onload=c.onreadystatechange=null,f=!0,void b())},c.src=a,e.insertBefore(c,e.firstChild)},0),null===d.readyState&&d.addEventListener&&(d.readyState="loading",d.addEventListener("DOMContentLoaded",c=function(){d.removeEventListener("DOMContentLoaded",c,!1),d.readyState="complete"},!1))}Keen.prototype.configure=function(a){return a.host=_isUndefined(a.host)?"api.keen.io/3.0":a.host.replace(/.*?:\/\//g,""),a.protocol=_set_protocol(a.protocol),a.requestType=_set_request_type(a.requestType),this.client={projectId:a.projectId,writeKey:a.writeKey,readKey:a.readKey,globalProperties:null,endpoint:a.protocol+"://"+a.host,requestType:a.requestType},Keen.trigger("client",this,a),this.trigger("ready"),this};var Events=Keen.Events={on:function(a,b){this.listeners||(this.listeners={});var c=this.listeners[a]||(this.listeners[a]=[]);return c.push({callback:b}),this},once:function(a,b,c){var d=this,e=_once(function(){d.off(a,e),b.apply(this,arguments)});return e._callback=b,d.on(a,e,c)},off:function(a,b,c){if(!this.listeners)return this;if(!a&&!b&&!c)return this.listeners=void 0,this;var d=[];a?d.push(a):_each(this.listeners,function(a,b){d.push(b)});for(var e=0,f=d.length;f>e;e++){a=d[e];var g=this.listeners[a];if(g)if(b||c){for(var h=[],i=0,j=g.length;j>i;i++){var k=g[i];(b&&b!==k.callback&&b!==k.callback._callback||c&&c!==k.context)&&h.push(k)}h.length?this.listeners[a]=h:delete this.listeners[a]}else delete this.listeners[a]}return this},trigger:function(a){if(!this.listeners)return this;for(var b=Array.prototype.slice.call(arguments,1),c=this.listeners[a]||[],d=0;d<c.length;d++)c[d].callback.apply(this,b);return this}};_extend(Keen.prototype,Events),_extend(Keen,Events),Keen.loaded=!0,Keen.urlMaxLength=16e3,(-1!==navigator.userAgent.indexOf("MSIE")||navigator.appVersion.indexOf("Trident/")>0)&&(Keen.urlMaxLength=2e3),Keen.utils={each:_each,extend:_extend,parseParams:_parse_params},Keen.ready=function(a){Keen.loaded?a():Keen.on("ready",a)},Keen.log=function(a){"object"==typeof console&&console.log("[Keen IO]",a)};var Plugins=Keen.Plugins={};Keen.prototype.addEvent=function(){_uploadEvent.apply(this,arguments)},Keen.prototype.trackExternalLink=function(a,b,c,d,e){var f,g,h=a,i=h.currentTarget?h.currentTarget:h.srcElement||h.target,j=d||500,k=!1,l="";return void 0!==i.getAttribute?l=i.getAttribute("target"):i.target&&(l=i.target),"_blank"!=l&&"blank"!=l||h.metaKey||(g=window.open("about:blank"),g.document.location=i.href),"A"===i.nodeName?f=function(){k||h.metaKey||"_blank"===l||"blank"===l||(k=!0,window.location=i.href)}:"FORM"===i.nodeName?f=function(){k||(k=!0,i.submit())}:Keen.log("#trackExternalLink method not attached to an <a> or <form> DOM element"),e&&(f=function(){k||(k=!0,e())}),_uploadEvent.call(this,b,c,f,f),setTimeout(f,j),h.metaKey?void 0:!1},Keen.prototype.setGlobalProperties=function(a){if(!this.client)return Keen.log("Check out our JavaScript SDK Usage Guide: https://keen.io/docs/clients/javascript/usage-guide/");if(!a||"function"!=typeof a)throw new Error("Invalid value for global properties: "+a);this.client.globalProperties=a},Keen.prototype.run=function(a,b,c){var d=[],e=b,f=c;b=null,c=null,"Array"===_type(a)?d=a:d.push(a);var g=new Keen.Request(this,d,e,f);return e=f=null,g},Keen.Request=function(a,b,c,d){var e=c,f=d;c=null,d=null,this.configure(a,b,e,f),e=f=null},_extend(Keen.Request.prototype,Events),Keen.Request.prototype.configure=function(a,b,c,d){return this.instance=a,this.queries=b,this.data,this.success=c,c=null,this.error=d,d=null,this.refresh(),this},Keen.Request.prototype.refresh=function(){var a=this,b=0,c=[],d=function(d,e){c[e]=d,a.queries[e].data=d,a.queries[e].trigger("complete",a.queries[e].data),b++,b==a.queries.length&&(a.data=1==a.queries.length?c[0]:c,a.trigger("complete",a.data),a.success&&a.success(a.data))},e=function(b,c){var d=JSON.parse(b.responseText);a.trigger("error",d),a.error&&a.error(b,c),Keen.log(b.statusText+" ("+d.error_code+"): "+d.message)};return _each(a.queries,function(b,c){var f,g=function(a){d(a,c)},h=function(a){e(a,c)};if(b instanceof Keen.Query)f=_build_url.call(a.instance,b.path),_sendQuery.call(a.instance,f,b.params,g,h);else if("[object String]"===Object.prototype.toString.call(b))f=_build_url.call(a.instance,"/saved_queries/"+encodeURIComponent(b)+"/result"),_sendQuery.call(a.instance,f,null,g,h);else{var i={statusText:"Bad Request",responseText:{message:"Error: Query "+(+c+1)+" of "+a.queries.length+" for project "+a.instance.client.projectId+" is not a valid request"}};Keen.log(i.responseText.message),Keen.log("Check out our JavaScript SDK Usage Guide for Data Analysis:"),Keen.log("https://keen.io/docs/clients/javascript/usage-guide/#analyze-and-visualize"),a.error&&a.error(i.responseText.message)}}),this},Keen.Query=function(){this.configure.apply(this,arguments)},_extend(Keen.Query.prototype,Events),Keen.Query.prototype.configure=function(a,b){return this.analysis=a,this.path="/queries/"+a,this.params=this.params||{},this.set(b),void 0===this.params.timezone&&(this.params.timezone=_getTimezoneOffset()),this},Keen.Query.prototype.get=function(a){var b=a;return b.match(new RegExp("[A-Z]"))&&(b=b.replace(/([A-Z])/g,function(a){return"_"+a.toLowerCase()})),this.params?this.params[b]||null:void 0},Keen.Query.prototype.set=function(a){var b=this;return _each(a,function(a,c){var d=c,e=a;c.match(new RegExp("[A-Z]"))&&(d=c.replace(/([A-Z])/g,function(a){return"_"+a.toLowerCase()})),b.params[d]=e,"Array"===_type(e)&&_each(e,function(a,c){"Object"===_type(a)&&_each(a,function(a,e){if(e.match(new RegExp("[A-Z]"))){var f=e.replace(/([A-Z])/g,function(a){return"_"+a.toLowerCase()});delete b.params[d][c][e],b.params[d][c][f]=a}})})}),b},Keen.Query.prototype.addFilter=function(a,b,c){return this.params.filters=this.params.filters||[],this.params.filters.push({property_name:a,operator:b,property_value:c}),this},Keen.Base64={map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(a){var b,c,d,e,f,g,h,i="",j=0,k=this.map;for(a=this.utf8.encode(a);j<a.length;)b=a.charCodeAt(j++),c=a.charCodeAt(j++),d=a.charCodeAt(j++),e=b>>2,f=(3&b)<<4|c>>4,g=isNaN(c)?64:(15&c)<<2|d>>6,h=isNaN(c)||isNaN(d)?64:63&d,i=i+k.charAt(e)+k.charAt(f)+k.charAt(g)+k.charAt(h);return i},decode:function(a){var b,c,d,e,f,g,h,i="",j=0,k=this.map,l=String.fromCharCode;for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");j<a.length;)b=k.indexOf(a.charAt(j++)),c=k.indexOf(a.charAt(j++)),d=k.indexOf(a.charAt(j++)),e=k.indexOf(a.charAt(j++)),f=b<<2|c>>4,g=(15&c)<<4|d>>2,h=(3&d)<<6|e,i=i+(l(f)+(64!=d?l(g):""))+(64!=e?l(h):"");return this.utf8.decode(i)},utf8:{encode:function(a){for(var b,c="",d=0,e=String.fromCharCode;d<a.length;)b=a.charCodeAt(d++),c+=128>b?e(b):b>127&&2048>b?e(b>>6|192)+e(63&b|128):e(b>>12|224)+e(b>>6&63|128)+e(63&b|128);return c},decode:function(a){for(var b,c,d="",e=0,f=String.fromCharCode;e<a.length;)c=a.charCodeAt(e),d+=128>c?[f(c),e++][0]:c>191&&224>c?[f((31&c)<<6|63&(b=a.charCodeAt(e+1))),e+=2][0]:[f((15&c)<<12|(63&(b=a.charCodeAt(e+1)))<<6|63&(c3=a.charCodeAt(e+2))),e+=3][0];return d}}},"object"!=typeof JSON&&(JSON={}),function(){function f(a){return 10>a?"0"+a:a}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g,h=gap,i=b[a];switch(i&&"object"==typeof i&&"function"==typeof i.toJSON&&(i=i.toJSON(a)),"function"==typeof rep&&(i=rep.call(b,a,i)),typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";if(gap+=indent,g=[],"[object Array]"===Object.prototype.toString.apply(i)){for(f=i.length,c=0;f>c;c+=1)g[c]=str(c,i)||"null";return e=0===g.length?"[]":gap?"[\n"+gap+g.join(",\n"+gap)+"\n"+h+"]":"["+g.join(",")+"]",gap=h,e}if(rep&&"object"==typeof rep)for(f=rep.length,c=0;f>c;c+=1)"string"==typeof rep[c]&&(d=rep[c],e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));return e=0===g.length?"{}":gap?"{\n"+gap+g.join(",\n"+gap)+"\n"+h+"}":"{"+g.join(",")+"}",gap=h,e}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(a,b,c){var d;if(gap="",indent="","number"==typeof c)for(d=0;c>d;d+=1)indent+=" ";else"string"==typeof c&&(indent=c);if(rep=b,b&&"function"!=typeof b&&("object"!=typeof b||"number"!=typeof b.length))throw new Error("JSON.stringify");return str("",{"":a})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&"object"==typeof e)for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=walk(e,c),void 0!==d?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),function(a,b){a.Dataform=b()}(Keen,function(){function a(a,b){this.configure(a,b)}function b(a){var b=this,c=[],d=[],g=function(){var c,d;return""==a.collection?c=b.raw:(d=e.apply(b,[b.raw].concat(a.collection.split(" -> "))),c=d[0]),"[object Array]"!==Object.prototype.toString.call(c)&&(c=[c]),c}();return h(a.select,function(a){c.push(a.path.split(" -> "))}),0==c.length&&h(g,function(a){var b=f(a);for(var e in b)b.hasOwnProperty(e)&&-1==d.indexOf(e)&&(d.push(e),c.push([e]))}),h(g,function(a,d){var e=f(a);b.table.push([]),h(c,function(a){var c=a.join(".");0==d&&b.table[0].push(c),b.table[d+1].push(void 0!==e[c]||"boolean"==typeof e[c]?e[c]:null)})}),b.format(a.select),b.sort(a.sort),b}function c(a){var b=this,c=[],d=a.unpack.value?a.unpack.value.path.split(" -> "):!1,f=a.unpack.label?a.unpack.label.path.split(" -> "):!1,g=a.unpack.index?a.unpack.index.path.split(" -> "):!1,i=""!==d[d.length-1]?d[d.length-1]:"Value",j=""!==f[f.length-1]?f[f.length-1]:"Label",k=""!==g[g.length-1]?g[g.length-1]:"Index",l=(a.sort&&a.sort.index?a.sort.index:!1,a.sort&&a.sort.value?a.sort.value:!1,function(){var c;return c=""==a.collection?[b.raw]:e.apply(b,[b.raw].concat(a.collection.split(" -> "))),c[0]}());return l instanceof Array==0&&(l=[l]),h(l,function(a){var d=f?e.apply(b,[a].concat(f)):[];d&&(c=d)}),h(l,function(a,f){var m=d?e.apply(b,[a].concat(d)):!1,n=g?e.apply(b,[a].concat(g)):!1;n?h(n,function(){b.table.push([])}):b.table.push([]),n&&(0==f&&(b.table[0].push(k),c.length>0?h(c,function(a){b.table[0].push(a)}):b.table[0].push(i)),l.length<b.table.length-1?0==f&&h(b.table,function(a,c){c>0&&b.table[c].push(n[c-1])}):b.table[f+1].push(n[0])),!n&&c.length>0&&(0==f&&(b.table[0].push(j),b.table[0].push(i)),b.table[f+1].push(c[0])),n||0!=c.length||b.table[0].push(""),m?l.length<b.table.length-1?0==f&&h(b.table,function(a,c){c>0&&b.table[c].push(m[c-1])}):h(m,function(a){b.table[f+1].push(a)}):h(b.table[0],function(a,c){var d=n?0:-1;c>d&&b.table[f+1].push(null)})}),b.format(a.unpack),b.sort(a.sort),this}function d(a){return h(a.unpack,function(b,c){b&&g(b,"string")&&(a.unpack[c]={path:a.unpack[c]})}),a}function e(){var a=[],b=function(){var c=arguments[0],d=Array.prototype.slice.call(arguments,1),e=d.pop();return 0===d.length&&(c instanceof Array?d=c:"object"==typeof c&&d.push(c)),h(d,function(f){if(""==e&&("number"==typeof f||null==f))return a.push(f);if(f[e]||0===f[e]||void 0!==f[e])return a.push(null===f[e]?null:f[e]);if(!c[f]){if("object"!=typeof c||c instanceof Array!=!1||c[e])return b.apply(this,[f].concat(d.splice(1)).concat(e));throw new Error("Target property does not exist",e)}return c[f]instanceof Array?void h(c[f],function(a,g){var h=[c[f]].concat(c[f][g]).concat(d.slice(1)).concat(e);return b.apply(this,h)}):c[f][e]?a.push(c[f][e]):b.apply(this,[c[f]].concat(d.splice(1)).concat(e))}),a.length>0?a:void 0};return b.apply(this,arguments)}function f(a){var b={};for(var c in a)if(a.hasOwnProperty(c))if("object"==typeof a[c]&&null!==a[c]){var d=f(a[c]);for(var e in d)d.hasOwnProperty(e)&&(b[c+"."+e]=d[e])}else b[c]=a[c];return b}function g(a,b){return a=typeof a,b?a==b:"undefined"!=a}function h(a,b,c){var d;if(!a)return 0;if(c=c?c:a,g(a.length)){for(d=0;d<a.length;d++)if(b.call(c,a[d],d,a)===!1)return 0}else for(d in a)if(a.hasOwnProperty(d)&&b.call(c,a[d],d,a)===!1)return 0;return 1}function i(a,b){return h(b,function(b,c){g(a[c],"object")&&g(b,"object")?a[c]=i(a[c],b):null!==b&&(a[c]=b)}),a}function j(a,b){var c=a,d=b||{};if(d.method){var e=c,f=window;if(h(d.method.split("."),function(a){f[a]&&(f=f[a])}),"function"==typeof f)try{c=f.apply(null,[c,d])}catch(g){c=e}}if(d.replace&&h(d.replace,function(a,b){(c==b||String(c)==String(b)||parseFloat(c)==parseFloat(b))&&(c=a)}),d.type&&"date"==d.type&&(c=d.format&&moment&&moment(a).isValid()?moment(c).format(d.format):new Date(c)),d.type&&"string"==d.type&&(c=String(c),d.format))switch(d.format){case"capitalize":c=c.replace(/[^\s]+/g,function(a){return a.replace(/^./,function(a){return a.toUpperCase()})});break;case"uppercase":c=c.toUpperCase();break;case"lowercase":c=c.toLowerCase()}return d.type&&"number"==d.type&&!isNaN(parseFloat(c))&&(c=parseFloat(c),d.format&&(-1!==d.format.indexOf(".")&&(c=function(a){var b=d.format.split("."),c=b[b.length-1].length;return a.toFixed(c)}(c)),-1!==d.format.indexOf(",")&&(c=function(a){for(var b=String(a).split(".");/(\d+)(\d{3})/.test(b[0]);)b[0]=b[0].replace(/(\d+)(\d{3})/,"$1,$2");return b.join(".")}(c)))),d.prefix&&(c=String(d.prefix)+c),d.suffix&&(c+=String(d.suffix)),c}return a.prototype.configure=function(a,e){var f,h=this;if(h.raw=h.raw||a,h.schema=h.schema||e||{},h.table=[[]],h.schema.collection&&0==g(h.schema.collection,"string"))throw new Error("schema.collection must be a string");if(h.schema.unpack&&h.schema.select)throw new Error("schema.unpack and schema.select cannot be used together");return h.schema.unpack&&(this.action="unpack",f=i({collection:"",unpack:{index:!1,value:!1,label:!1}},h.schema),f=d(f),c.call(this,f)),h.schema.select&&(this.action="select",f=i({collection:"",select:!0},h.schema),f=d(f),b.call(this,f)),this},i(a,{each:h,extend:i,is:g,flatten:f}),window.moment&&(moment.suppressDeprecationWarnings=!0),a.prototype.format=function(a){var b,c=this,d={number:{},date:{},string:{prefix:"",suffix:""}};return"select"==c.action&&(b=[],h(a,function(a){var c,e={};h(d,function(a,b){e[b]=i({},a)}),c=e[a.type]?i(e[a.type],a):a,b.push(c)}),h(c.table,function(a,d){0==d?h(a,function(a,e){b[e]&&b[e].label&&(c.table[d][e]=b[e].label)}):h(a,function(a,e){c.table[d][e]=j(c.table[d][e],b[e])})})),"unpack"==c.action&&(b={},h(a,function(a,c){var e={};h(d,function(a,b){e[b]=i({},a)}),b[c]=e[c]?i(e[c],a):a}),b.index&&h(c.table,function(a,d){0==d?b.index.label&&(c.table[d][0]=b.index.label):c.table[d][0]=j(c.table[d][0],b.index)}),b.label&&(b.index?h(c.table,function(a,d){h(a,function(a,e){0==d&&e>0&&(c.table[d][e]=j(c.table[d][e],b.label))})}):h(c.table,function(a,d){d>0&&(c.table[d][0]=j(c.table[d][0],b.label))})),b.value&&(b.index?h(c.table,function(a,d){h(a,function(a,e){d>0&&e>0&&(c.table[d][e]=j(c.table[d][e],b.value))})}):h(c.table,function(a,d){h(a,function(a,e){d>0&&(c.table[d][e]=j(c.table[d][e],b.value))})}))),c},a.prototype.sort=function(a){var b,c=this;return"unpack"==c.action&&(b=i({index:!1,value:!1},a),b.index&&!function(){var a=c.table[0],d=c.table.splice(1);d.sort(function(a,c){return"asc"==b.index?a[0]>c[0]?1:-1:"desc"==b.index?a[0]>c[0]?-1:1:!1}),c.table=[a].concat(d)}(),b.value&&c.schema.unpack.label&&c.table[0].length>2&&!function(){var a=c.table[0],d=c.table.splice(1),e=[],f=c.schema.unpack.index?0:-1;h(a,function(a,b){b>f&&e.push({label:a,values:[],total:0})}),h(d,function(a){h(a,function(a,b){b>f&&(g(a,"number")&&(e[b-1].total+=a),e[b-1].values.push(a))})}),("number"==c.schema.unpack.label.type||g(d[0][1],"number"))&&e.sort(function(a,c){return"asc"==b.value?a.total>c.total?1:-1:"desc"==b.value?a.total>c.total?-1:1:!1}),h(e,function(b,c){a[f+1+c]=e[c].label,h(d,function(a,b){a[f+1+c]=e[c].values[b]})}),c.table=[a].concat(d)}()),"select"==c.action&&(b=i({column:0,order:!1},a),0!=b.order&&!function(){var a=c.table[0],d=c.table.splice(1);d.sort(function(a,c){var d=null===a[b.column]||void 0===a[b.column]?"":a[b.column],e=null===c[b.column]||void 0===c[b.column]?"":c[b.column];return"asc"==b.order?d>e?1:-1:"desc"==b.order?d>e?-1:1:0}),c.table=[a].concat(d)}()),c},a}),function(a,b){a.utils.domready=b()}(Keen,function(a){function b(a){for(n=1;a=d.shift();)a()}var c,d=[],e=!1,f=document,g=f.documentElement,h=g.doScroll,i="DOMContentLoaded",j="addEventListener",k="onreadystatechange",l="readyState",m=h?/^loaded|^c/:/^loaded|c/,n=m.test(f[l]);return f[j]&&f[j](i,c=function(){f.removeEventListener(i,c,e),b()},e),h&&f.attachEvent(k,c=function(){/^c/.test(f[l])&&(f.detachEvent(k,c),b())}),a=h?function(b){self!=top?n?b():d.push(b):function(){try{g.doScroll("left")}catch(c){return setTimeout(function(){a(b)},50)}b()}()}:function(a){n?a():d.push(a)}}),function(a,b){a.Spinner=b()}(Keen,function(){function a(a,b){var c,d=document.createElement(a||"div");for(c in b)d[c]=b[c];return d}function b(a){for(var b=1,c=arguments.length;c>b;b++)a.appendChild(arguments[b]);return a}function c(a,b,c,d){var e=["opacity",b,~~(100*a),c,d].join("-"),f=.01+c/d*100,g=Math.max(1-(1-a)/b*(100-f),a),h=j.substring(0,j.indexOf("Animation")).toLowerCase(),i=h&&"-"+h+"-"||"";return l[e]||(m.insertRule("@"+i+"keyframes "+e+"{0%{opacity:"+g+"}"+f+"%{opacity:"+a+"}"+(f+.01)+"%{opacity:1}"+(f+b)%100+"%{opacity:"+a+"}100%{opacity:"+g+"}}",m.cssRules.length),l[e]=1),e}function d(a,b){var c,d,e=a.style;for(b=b.charAt(0).toUpperCase()+b.slice(1),d=0;d<k.length;d++)if(c=k[d]+b,void 0!==e[c])return c;return void 0!==e[b]?b:void 0}function e(a,b){for(var c in b)a.style[d(a,c)||c]=b[c];return a}function f(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)void 0===a[d]&&(a[d]=c[d])}return a}function g(a,b){return"string"==typeof a?a:a[b%a.length]}function h(a){this.opts=f(a||{},h.defaults,n)}function i(){function c(b,c){return a("<"+b+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',c)}m.addRule(".spin-vml","behavior:url(#default#VML)"),h.prototype.lines=function(a,d){function f(){return e(c("group",{coordsize:k+" "+k,coordorigin:-j+" "+-j}),{width:k,height:k})}function h(a,h,i){b(m,b(e(f(),{rotation:360/d.lines*a+"deg",left:~~h}),b(e(c("roundrect",{arcsize:d.corners}),{width:j,height:d.width,left:d.radius,top:-d.width>>1,filter:i}),c("fill",{color:g(d.color,a),opacity:d.opacity}),c("stroke",{opacity:0}))))}var i,j=d.length+d.width,k=2*j,l=2*-(d.width+d.length)+"px",m=e(f(),{position:"absolute",top:l,left:l});if(d.shadow)for(i=1;i<=d.lines;i++)h(i,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(i=1;i<=d.lines;i++)h(i);return b(a,m)},h.prototype.opacity=function(a,b,c,d){var e=a.firstChild;d=d.shadow&&d.lines||0,e&&b+d<e.childNodes.length&&(e=e.childNodes[b+d],e=e&&e.firstChild,e=e&&e.firstChild,e&&(e.opacity=c))}}var j,k=["webkit","Moz","ms","O"],l={},m=function(){var c=a("style",{type:"text/css"});return b(document.getElementsByTagName("head")[0],c),c.sheet||c.styleSheet}(),n={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",direction:1,speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",position:"absolute"};h.defaults={},f(h.prototype,{spin:function(b){this.stop();{var c=this,d=c.opts,f=c.el=e(a(0,{className:d.className}),{position:d.position,width:0,zIndex:d.zIndex});d.radius+d.length+d.width}if(e(f,{left:d.left,top:d.top}),b&&b.insertBefore(f,b.firstChild||null),f.setAttribute("role","progressbar"),c.lines(f,c.opts),!j){var g,h=0,i=(d.lines-1)*(1-d.direction)/2,k=d.fps,l=k/d.speed,m=(1-d.opacity)/(l*d.trail/100),n=l/d.lines;!function o(){h++;for(var a=0;a<d.lines;a++)g=Math.max(1-(h+(d.lines-a)*n)%l*m,d.opacity),c.opacity(f,a*d.direction+i,g,d);c.timeout=c.el&&setTimeout(o,~~(1e3/k))}()}return c},stop:function(){var a=this.el;return a&&(clearTimeout(this.timeout),a.parentNode&&a.parentNode.removeChild(a),this.el=void 0),this},lines:function(d,f){function h(b,c){return e(a(),{position:"absolute",width:f.length+f.width+"px",height:f.width+"px",background:b,boxShadow:c,transformOrigin:"left",transform:"rotate("+~~(360/f.lines*k+f.rotate)+"deg) translate("+f.radius+"px,0)",borderRadius:(f.corners*f.width>>1)+"px"})}for(var i,k=0,l=(f.lines-1)*(1-f.direction)/2;k<f.lines;k++)i=e(a(),{position:"absolute",top:1+~(f.width/2)+"px",transform:f.hwaccel?"translate3d(0,0,0)":"",opacity:f.opacity,animation:j&&c(f.opacity,f.trail,l+k*f.direction,f.lines)+" "+1/f.speed+"s linear infinite"}),f.shadow&&b(i,e(h("#000","0 0 4px #000"),{top:"2px"})),b(d,b(i,h(g(f.color,k),"0 0 1px rgba(0,0,0,.1)")));return d},opacity:function(a,b,c){b<a.childNodes.length&&(a.childNodes[b].style.opacity=c)}});var o=e(a("group"),{behavior:"url(#default#VML)"});return!d(o,"transform")&&o.adj?i():j=d(o,"animation"),h}),Keen.prototype.draw=function(a,b,c){var c=c||{},d=b,e=document.createElement("div");e.className="keen-loading",e.style.height=(c.height||Keen.Visualization.defaults.height)+"px",e.style.position="relative",e.style.width=(c.width||Keen.Visualization.defaults.width)+"px",d.innerHTML="",d.appendChild(e);var f=new Keen.Spinner({lines:10,length:8,width:3,radius:10,corners:1,rotate:0,direction:1,color:"#4d4d4d",speed:1,trail:60,shadow:!1,hwaccel:!1,className:"keen-spinner",zIndex:2e9,top:"50%",left:"50%"}).spin(e),g=new Keen.Request(this,[a]);return g.on("complete",function(){e&&null!==e.parentNode&&(f.stop(),d.removeChild(e),e=null),this.draw(b,c)}),g.on("error",function(a){var b,c;f.stop(),d.removeChild(e),b=Keen.utils.extend({error:a,el:d},Keen.Visualization.defaults),c=new Keen.Visualization.libraries["keen-io"].error(b)}),g},Keen.Request.prototype.draw=function(a,b){return _build_visual.call(this,a,b),this.on("complete",function(){_build_visual.call(this,a,b)}),this},Keen.Visualization=function(a,b,c){var d,e,f,g,h,i;e=JSON.parse(JSON.stringify(Keen.Visualization.defaults)),f=_extend(e,c||{}),g=Keen.Visualization.libraries[f.library],f.el=b,i={collection:"result",select:!0},!f.title&&a instanceof Keen.Request&&(f.title=function(){var b,c=a.queries[0].analysis.replace("_"," "),d=a.queries[0].get("event_collection");return b=c.replace(/\b./g,function(a){return a.toUpperCase()}),d&&(b+=" - "+d),b}());var j=!1,k=!1,l=!1,m=!1,n=!1,o=!1;if(a instanceof Keen.Request?(j="number"==typeof a.data.result||null===a.data.result?!0:!1,k=a.queries[0].get("steps")?!0:!1,l=a.queries[0].get("interval")?!0:!1,m=a.queries[0].get("group_by")?!0:!1,n=a.queries[0].get("group_by")instanceof Array?!0:!1,o="extraction"==a.queries[0].analysis?!0:!1,d=a.data instanceof Array?a.data[0]:a.data):"string"==typeof a||(d=a instanceof Array?a[0]:a,j="number"==typeof d.result||null===d.result?!0:!1),j&&(f.capable=["metric"],h="metric"),!l&&m&&(f.capable=["piechart","barchart","columnchart","table"],h="piechart","barchart"==f.chartType&&(f.chartOptions.legend={position:"none"})),l&&!m&&(f.capable=["areachart","barchart","columnchart","linechart","table"],h="areachart","google"==f.library&&void 0==f.chartOptions.legend&&(f.chartOptions.legend={position:"none"})),l&&m&&(f.capable=["areachart","barchart","columnchart","linechart","table"],h="linechart"),k&&(f.capable=["areachart","barchart","columnchart","linechart","table"],h="columnchart","google"==f.library&&(f.chartOptions.legend={position:"none"})),n&&(f.capable=["areachart","barchart","columnchart","linechart","table"],h="columnchart"),n&&(i={collection:"result",sort:{index:"asc",label:"desc"}},i.unpack=l?{index:"timeframe -> start",label:"value -> "+a.queries[0].params.group_by[0],value:"value -> result"}:{index:a.queries[0].params.group_by[0],label:a.queries[0].params.group_by[1],value:"result"}),o&&(f.capable=["table"],h="table"),o&&(i={collection:"result",select:!0},a.queries[0].get("property_names"))){i.select=[];
for(var p=0;p<a.queries[0].get("property_names").length;p++)i.select.push({path:a.queries[0].get("property_names")[p]})}if(f.chartType||(f.chartType=h),"metric"==f.chartType&&(f.library="keen-io"),void 0==f.chartOptions.lineWidth&&(f.chartOptions.lineWidth=2),"piechart"==f.chartType&&void 0==f.chartOptions.sliceVisibilityThreshold&&(f.chartOptions.sliceVisibilityThreshold=.01),("columnchart"==f.chartType||"areachart"==f.chartType||"linechart"==f.chartType)&&(void 0==f.chartOptions.hAxis&&(f.chartOptions.hAxis={baselineColor:"transparent",gridlines:{color:"transparent"}}),void 0==f.chartOptions.vAxis&&(f.chartOptions.vAxis={viewWindow:{min:0}})),f.data=d?_transform.call(f,d,i):[],f.colorMapping&&(f.data.schema.select&&2==f.data.table[0].length&&_each(f.data.table,function(a,b){b>0&&f.colorMapping[a[0]]&&f.colors.splice(b-1,0,f.colorMapping[a[0]])}),f.data.schema.unpack&&_each(f.data.table[0],function(a,b){b>0&&f.colorMapping[a]&&f.colors.splice(b-1,0,f.colorMapping[a])})),f.library){if(Keen.Visualization.libraries[f.library][f.chartType])return new Keen.Visualization.libraries[f.library][f.chartType](f);throw new Error("The library you selected does not support this chartType")}throw new Error("The library you selected is not present")},Keen.Visualization.defaults={library:"google",height:400,width:600,colors:["#00afd7","#f35757","#f0ad4e","#8383c6","#f9845b","#49c5b1","#2a99d1","#aacc85","#ba7fab"],chartOptions:{}},Keen.Visualization.libraries={},Keen.Visualization.register=function(a,b){Keen.Visualization.libraries[a]=Keen.Visualization.libraries[a]||{};for(var c in b)Keen.Visualization.libraries[a][c]=b[c]},Keen.Visualization.visuals=[];var baseVisualization=function(a){var b=this;_extend(b,a),b.on("error",function(){var b,c;b=Keen.utils.extend({error:{message:arguments[0]}},a),c=new Keen.Visualization.libraries["keen-io"].error(b)}),b.on("update",function(){b.update.apply(this,arguments)}),b.on("remove",function(){b.remove.apply(this,arguments)}),b.initialize(),Keen.Visualization.visuals.push(b)};baseVisualization.prototype={initialize:function(){},render:function(){},update:function(){},remove:function(){}},_extend(baseVisualization.prototype,Events),Keen.Visualization.extend=function(a,b){var c,d=baseVisualization;c=a&&a.hasOwnProperty("constructor")?a.constructor:function(){return d.apply(this,arguments)},_extend(c,d,b);var e=function(){this.constructor=c};return e.prototype=d.prototype,c.prototype=new e,a&&_extend(c.prototype,a),c.__super__=d.prototype,c};var ErrorMessage=Keen.Visualization.extend({initialize:function(){var a,b;a=document.createElement("div"),a.className="keen-error",a.style.borderRadius="8px",a.style.height=this.height+"px",a.style.width=this.width+"px",b=document.createElement("span"),b.style.color="#ccc",b.style.display="block",b.style.paddingTop=this.height/2-15+"px",b.style.fontFamily="Helvetica Neue, Helvetica, Arial, sans-serif",b.style.fontSize="21px",b.style.fontWeight="light",b.style.textAlign="center",b.innerHTML=this.error.message,a.appendChild(b),this.el.innerHTML="",this.el.appendChild(a)}});Keen.Visualization.register("keen-io",{error:ErrorMessage}),Keen.Visualization.find=function(a){var b,c;if(a){if(b=a.nodeName?a:document.querySelector(a),_each(Keen.Visualization.visuals,function(a){return b==a.el?(c=a,!1):void 0}),c)return c;throw"Visualization not found"}return Keen.Visualization.visuals},_extend(Keen.utils,{prettyNumber:_pretty_number,loadScript:_load_script}),Keen.loaded=!1,function(a){function b(a){var b=k[a.id]||a.message||"An error occurred";this.trigger("error",b)}function c(){var a=this;google.visualization.events.removeAllListeners(a._chart),a._chart.clearChart()}var d,e,f,g,h,i,j=a||{},k={"google-visualization-errors-0":"No results to visualize"};j.utils.loadScript("https://www.google.com/jsapi",function(){if("undefined"==typeof google)throw new Error("Problem loading Google Charts library. Please contact us!");google.load("visualization","1.1",{packages:["corechart","table"],callback:function(){j.loaded=!0,j.trigger("ready")}})}),d=j.Visualization.extend({initialize:function(){this.render()},render:function(){var a=this;a._chart=a._chart||new google.visualization.AreaChart(a.el),google.visualization.events.addListener(a._chart,"error",function(c){b.call(a,c)}),this.update()},update:function(){this.remove();var a=google.visualization.arrayToDataTable(this.data.table),b=j.utils.extend(this.chartOptions,{title:this.title||"",height:parseInt(this.height),width:parseInt(this.width),colors:this.colors});this._chart.draw(a,b)},remove:function(){c.call(this)}}),e=j.Visualization.extend({initialize:function(){this.render()},render:function(){var a=this;a._chart=a._chart||new google.visualization.BarChart(a.el),google.visualization.events.addListener(a._chart,"error",function(c){b.call(a,c)}),a.update()},update:function(){this.remove();var a=google.visualization.arrayToDataTable(this.data.table),b=j.utils.extend(this.chartOptions,{title:this.title||"",height:parseInt(this.height),width:parseInt(this.width),colors:this.colors});this._chart.draw(a,b)},remove:function(){c.call(this)}}),f=j.Visualization.extend({initialize:function(){this.render()},render:function(){var a=this;a._chart=a._chart||new google.visualization.ColumnChart(a.el),google.visualization.events.addListener(a._chart,"error",function(c){b.call(a,c)}),a.update()},update:function(){this.remove();var a=google.visualization.arrayToDataTable(this.data.table),b=j.utils.extend(this.chartOptions,{title:this.title||"",height:parseInt(this.height),width:parseInt(this.width),colors:this.colors});this._chart.draw(a,b)},remove:function(){c.call(this)}}),g=j.Visualization.extend({initialize:function(){this.render()},render:function(){var a=this;a._chart=a._chart||new google.visualization.LineChart(a.el),google.visualization.events.addListener(a._chart,"error",function(c){b.call(a,c)}),a.update()},update:function(){this.remove();var a=google.visualization.arrayToDataTable(this.data.table),b=j.utils.extend(this.chartOptions,{title:this.title||"",height:parseInt(this.height),width:parseInt(this.width),colors:this.colors});this._chart.draw(a,b)},remove:function(){c.call(this)}}),h=j.Visualization.extend({initialize:function(){this.render()},render:function(){var a=this;a._chart=a._chart||new google.visualization.PieChart(a.el),google.visualization.events.addListener(a._chart,"error",function(c){b.call(a,c)}),a.update()},update:function(){this.remove();var a=google.visualization.arrayToDataTable(this.data.table),b=j.utils.extend(this.chartOptions,{title:this.title||"",height:parseInt(this.height),width:parseInt(this.width),colors:this.colors});this._chart.draw(a,b)},remove:function(){c.call(this)}}),i=j.Visualization.extend({initialize:function(){this.render()},render:function(){var a=this;a._chart=a._chart||new google.visualization.Table(a.el),google.visualization.events.addListener(a._chart,"error",function(c){b.call(a,c)}),a.update()},update:function(){this.remove();var a=google.visualization.arrayToDataTable(this.data.table),b=j.utils.extend(this.chartOptions,{title:this.title||"",height:parseInt(this.height),width:parseInt(this.width),colors:this.colors});this._chart.draw(a,b)},remove:function(){c.call(this)}}),j.Visualization.register("google",{areachart:d,barchart:e,columnchart:f,linechart:g,piechart:h,table:i})}(Keen),function(a){var b,c=a||{};b=c.Visualization.extend({initialize:function(){var a=document.createElement("style"),b="#49c5b1";a.id="keen-widgets",a.type="text/css",a.innerHTML="    .keen-metric { \n  background: "+b+"; \n  border-radius: 4px; \n  color: #fff; \n  font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; \n  padding: 10px 0; \n  text-align: center; \n}     .keen-metric-value { \n  display: block; \n  font-size: 84px; \n  font-weight: 700; \n  line-height: 84px; \n}     .keen-metric-title { \n  display: block; \n  font-size: 24px; \n  font-weight: 200; \n}",document.getElementById(a.id)||document.body.appendChild(a),this.render()},render:function(){var a=1==this.colors.length?this.colors[0]:"#49c5b1",b="",c="",d=this.title||"Result",e=this.data.table[1],f=parseInt(this.width);this.chartOptions.prefix&&(b='<span class="keen-metric-prefix">'+this.chartOptions.prefix+"</span>"),this.chartOptions.suffix&&(c='<span class="keen-metric-suffix">'+this.chartOptions.suffix+"</span>"),this.el.innerHTML='<div class="keen-widget keen-metric" style="background-color: '+a+"; width:"+f+'px;"><span class="keen-metric-value">'+b+e+c+'</span><span class="keen-metric-title">'+d+"</span></div>"}}),c.Visualization.register("keen-io",{metric:b})}(Keen);var loaded=window.Keen,cached=window._Keen||{},clients,ready;if(loaded&&cached){clients=cached.clients||{},ready=cached.ready||[];for(var instance in clients)if(clients.hasOwnProperty(instance)){var client=clients[instance];for(var method in Keen.prototype)Keen.prototype.hasOwnProperty(method)&&(loaded.prototype[method]=Keen.prototype[method]);if(loaded.Query=Keen.Query?Keen.Query:function(){},loaded.Visualization=Keen.Visualization?Keen.Visualization:function(){},client._config&&(client.configure.call(client,client._config),delete client._config),client._setGlobalProperties){for(var globals=client._setGlobalProperties,i=0;i<globals.length;i++)client.setGlobalProperties.apply(client,globals[i]);delete client._setGlobalProperties}if(client._addEvent){for(var queue=client._addEvent||[],i=0;i<queue.length;i++)client.addEvent.apply(client,queue[i]);delete client._addEvent}var callback=client._on||[];if(client._on){for(var i=0;i<callback.length;i++)client.on.apply(client,callback[i]);client.trigger("ready"),delete client._on}}for(var i=0;i<ready.length;i++){var callback=ready[i];Keen.once("ready",function(){callback()})}}return Keen.loaded&&setTimeout(function(){Keen.utils.domready(function(){Keen.trigger("ready")})},0),Keen});