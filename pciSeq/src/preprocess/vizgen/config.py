import os
from pathlib import Path
from collections import defaultdict

PROJECT_DIR = Path(os.path.dirname(os.path.realpath(__file__))).parent.absolute()
print(PROJECT_DIR)

# Location where the Vizgen raw data are kept
DROPBOX_URL = os.path.join('Z:\\')

# Root Location where the flatfiles from the preprocessing step will be saved (geneData, cellData etc...)
SAVE_TO =  os.path.join('D:\\', 'rotated_dapi_map_tiles')

def get_config(merfish_id, slice_id, region_id):
    out = {
        'cell_by_gene': os.path.join(DROPBOX_URL, merfish_id, slice_id, region_id, 'cell_by_gene.csv'),
        'cell_metadata': os.path.join(DROPBOX_URL, merfish_id, slice_id, region_id, 'cell_metadata.csv'),
        'detected_transcripts': os.path.join(DROPBOX_URL, merfish_id, slice_id, region_id, 'detected_transcripts.csv'),
        'micron_to_mosaic_pixel_transform': os.path.join(DROPBOX_URL, merfish_id, slice_id, region_id, 'images', 'micron_to_mosaic_pixel_transform.csv'),
        'dapi_tif': os.path.join(DROPBOX_URL, merfish_id, slice_id, region_id, 'images', 'mosaic_DAPI_z3.tif'),
        'cell_boundaries_dir': os.path.join(DROPBOX_URL, merfish_id, slice_id, region_id, 'cell_boundaries'),
        'clip_poly': _clip_poly[slice_id][region_id],
        'rotation': _rotation[slice_id][region_id],
        'target_dir': os.path.join(SAVE_TO, slice_id, region_id),
    }
    return out


# only spots within this poly will be plotted. Use empty array if you do not want any clipping to be applied
_clip_poly = defaultdict(dict)
_clip_poly['MsBrain_Eg1_VS6_JH_V6_05-02-2021']['region_0'] = [(25009,29875), (25594,32860), (27268,37773), (28476,42200), (28319,45239), (48535,40838), (72239,39897), (71366,38387), (68110,34895), (67266,32498), (63527,25493), (52594,26965), (45625,27624), (33621,28185)]
_clip_poly['MsBrain_Eg1_VS6_JH_V6_05-02-2021']['region_1'] = [(25106,29454), (26388,32536), (26659,38544), (28245,41168), (27516,44897), (48331,39522), (69056,36621), (65948,33412), (66650,32191), (65446,28944), (65549,22916), (45505,28184)]
_clip_poly['MsBrain_Eg2_VS6_V11_JH_05-02-2021']['region_0'] = [(28094,23896), (25746,25410), (24495,27027), (20162,29651), (17683,30951), (15614,31536), (33310,44154), (50425,59685), (51163,54493), (52558,47763), (55733,45640), (58030,44952), (47527,38343), (43377,38534), (40182,36575), (38295,34134), (38376,30361)]
_clip_poly['MsBrain_Eg2_VS6_V11_JH_05-02-2021']['region_1'] = [(22166,21044), (40780,31079), (43060,25614), (44783,20500), (48653,17247), (51944,17096), (39781,8273), (36062,8532), (33925,7331), (32613,6355)]
_clip_poly['MsBrain_Eg3_VS6_JH_V6_05-01-2021']['region_0'] = [(19359,45462), (21169,57544), (23716,57658), (24839,58191), (27401,60449), (30586,63612), (32761,66082), (43803,45026), (41638,22295), (30945,26491), (29633,26460), (28078,25179), (26332,23426), (22038,30291), (23938,30075), (25134,29845), (26418,31767), (26731,33919), (27215,37128), (27286,41473), (26035,43890), (24784,45855), (23503,46923), (21318,46846)]
_clip_poly['MsBrain_Eg3_VS6_JH_V6_05-01-2021']['region_1'] = [(20118,47441), (24203,54149), (26177,56640), (30439,61406), (40574,41546), (39264,20452), (37252,20928), (35823,20936), (27965,25666), (25275,25646), (27374,39593)]
_clip_poly['MsBrain_EG4_VS6library_V6_LH_04-14-21']['region_0'] = [(38795,34051), (48315,36706), (53254,35519), (57565,33713), (60644,28831), (63749,26289), (39603,18535), (16894,23371), (19447,28288), (21805,31870), (24055,34746), (27814,35267), (32734,34724)]
_clip_poly['MsBrain_EG4_VS6library_V6_LH_04-14-21']['region_1'] = [(39155,31287), (40553,31074), (42232,31653), (45079,32768), (48324,33984), (50624,34889), (53553,34110), (56277,32898), (58316,31663), (59659,30535), (64268,25448), (42512,16254), (19976,19858), (20980,21404), (23078,25355), (26402,29978), (28978,31853), (31479,31942), (34826,31488), (37966,31032)]
_clip_poly['MsBrain_Eg5_VS6_JH_V6_05-16-2021']['region_0'] = [(39035,30314), (45997,32143), (48813,33976), (51279,33900), (55589,33350), (59792,31342), (63320,25053), (40458,15638), (17272,20468), (17414,23563), (16671,25882), (16976,27139), (17830,28421), (20984,30671), (24045,31357), (27619,31120), (31897,31233), (36821,30905)]
_clip_poly['MsBrain_Eg5_VS6_JH_V6_05-16-2021']['region_1'] = [(38880,25636), (42937,25977), (46003,27877), (48962,29798), (52568,29600), (54399,28868), (57815,26794), (63062,21917), (63992,17897), (39511,10724), (15703,14987), (16212,19046), (17859,22727), (20355,24649), (22694,25969), (27225,27157), (30450,27080), (33618,26570)]


_clip_poly["MsBrain_ZM0_VS6_JH_V6_05-15-2021"]["region_0"] = [(23054,63265), (25434,63245), (29185,63098), (31673,63185), (35503,64704), (37423,65301), (38362,44637), (39902,27565), (38247,27520), (37332,26910), (36019,27398), (34709,28753), (33415,29622), (31155,30776), (29117,31468), (27652,30278), (26370,28599), (24264,26311)]
_clip_poly["MsBrain_ZM1_VS6_JH_V11_05-16-2021"]["region_0"] = [(38946,26660), (35233,26282), (33875,26076), (30686,25406), (28411,23967), (26785,22761), (21890,45270), (13050,63421), (20827,62503), (23185,62547), (25723,62724), (32020,62076), (35147,64719)]
_clip_poly["MsBrain_ZM2_VS6_JH_V11_05-15-2021"]["region_0"] = [(23117,24654), (26929,26072), (27535,27338), (27759,29437), (27705,32140), (26990,35421), (27376,37175), (27282,39431), (47416,34657), (66303,29019), (64389,26207), (63291,25089), (63332,24336), (61994,22090), (60104,20922), (57677,15412)]
_clip_poly["MsBrain_ZM3_VS6_JH_V11_05-17-2021"]["region_0"] = [(16361,52261), (18769,52857), (20240,53209), (22838,54025), (26823,55645), (28423,56122), (31614,57942), (44273,39745), (48459,22081), (47233,22241), (45604,22602), (43681,23218), (41582,23319), (40019,23235), (32120,22478), (30477,22258), (29084,21128), (28748,19263), (28821,17788), (25401,28413), (27235,28155), (28998,29010), (30223,30114), (30582,33393), (30471,35190), (29850,37350), (27864,39165), (25029,40745), (22049,40284)]
_clip_poly["MsBrain_ZM4_VS6_JH_V11_05-11-2021"]["region_0"] = [(17110,53798), (18581,54929), (20437,55139), (21291,54743), (23879,56080), (30109,60073), (33735,61986), (41078,38852), (39583,20387), (36997,20976), (34599,22132), (33471,23292), (30914,23750), (23331,24904), (20648,24224), (19062,22577), (17400,32247), (18975,31890), (20164,30791), (21231,29845), (23518,29170), (24582,30886), (25267,32943), (25495,37360), (25479,39734), (23482,42524), (21536,44930), (19956,45233), (18124,43998)]
_clip_poly["MsBrain_ZM5.1_VS6_JH_V11_05-12-2021"]["region_0"] = [(38627,20730), (36990,21247), (35170,21322), (30805,20657), (29401,20291), (28217,20749), (28031,22039), (27177,23167), (25813,23625), (23926,24538), (22248,25514), (19635,27371), (16305,29938), (34061,40886), (55409,48260), (54673,45623), (54323,44078), (53469,43102), (54002,41113), (53393,38714), (52156,35719), (51104,32632), (48066,32509), (46241,32814), (40550,30157), (35032,23686)]
_clip_poly["MsBrain_ZM5.2_VS6_JH_V6_05-13-2021"]["region_0"] = [(17646,41842), (16199,43444), (15421,44983), (15024,46844), (15330,49133), (15604,50109), (18508,50874), (22736,52525), (23845,53722), (25491,55596), (26889,58310), (29892,60686), (43462,41313), (43739,21163), (34934,24159), (32390,25321), (31305,24287), (26597,26469), (29275,27972), (29669,30422), (28997,33861), (28295,38319), (26833,40554), (23368,44056), (21483,44946), (19505,44342)]
_clip_poly["MsBrain_ZM6.1_VS6_V6_JH_05-11-2021"]["region_0"] = [(28207,37231), (23494,43335), (21871,45056), (21767,46972), (22220,49714), (23949,52425), (25790,54737), (27980,56960), (30147,59541), (43590,39121), (43358,18881), (39927,19695), (37464,20436), (35066,21685), (32393,22706), (31075,23664), (29855,24884), (29359,27034), (29604,29873), (29239,32825)]
_clip_poly["MsBrain_ZM7.1_VS6_V6_JH_05-12-2021"]["region_0"] = [(47778,32322), (48779,32139), (50953,31499), (52156,29058), (54197,26441), (55461,23801), (56237,21567), (57599,15933), (34517,15664), (13690,30318), (16090,30929), (18790,31930), (19986,33583), (21311,35285), (23910,36428), (26049,37162), (28871,37680), (30727,36750), (33095,34942), (36155,33546), (39275,31986), (43201,31769), (45700,31637)]
_clip_poly["MsBrain_ZM7.2_VS6_JH_V11_05-13-2021"]["region_0"] = [(24123,20115), (22358,19888), (20666,20222), (18542,20581), (16637,21205), (11962,22760), (9557,24080), (26936,39796), (50039,48626), (49708,46513), (49554,45238), (49330,39553), (49041,36505), (47367,34100), (45353,31658), (43736,31231), (40757,31034), (37234,29666), (34504,28396), (32340,26120), (30562,23250), (29189,21449), (27633,19954), (25954,19343)]

_clip_poly["VS6_MsBrain_B3_VS6library_V10_LH_02-07-21"]["region_0"] = [(32811,24434), (24302,27971), (25869,31328), (22956,39037), (21386,44749), (41573,42555), (62153,36609), (61773,33446), (59831,30981), (58378,28615), (56429,26215), (55774,24551), (55011,23087), (55682,22202), (56641,20926), (47359,23090), (47816,24066), (47951,25516), (46212,26766), (44135,27586), (42017,28485), (40362,28957), (38294,28759), (35650,28469), (33665,27869), (33299,26710), (33635,24989)]
_clip_poly["VS6_MsBrain_B3_VS6library_V10_LH_02-07-21"]["region_1"] = [(36665,23760), (25806,26432), (26790,28913), (26729,30987), (25876,32223), (24991,32284), (24838,33199), (23560,36238), (22494,36995), (23165,38728), (22616,39612), (21686,41772), (42974,41255), (62861,39682), (62515,37639), (62460,36170), (64191,35858), (63977,35095), (62328,32357), (61474,30802), (60064,27991), (59179,26252), (59210,24880), (60001,23330), (48674,23575), (48568,25399), (42932,27716), (37913,26221)]


_rotation = defaultdict(dict)
_rotation["MsBrain_Eg1_VS6_JH_V6_05-02-2021"]["region_0"] = 9,
_rotation["MsBrain_Eg1_VS6_JH_V6_05-02-2021"]["region_1"] = 11,
_rotation["MsBrain_Eg2_VS6_V11_JH_05-02-2021"]["region_0"] = -39,
_rotation["MsBrain_Eg2_VS6_V11_JH_05-02-2021"]["region_1"] = -42,
_rotation["MsBrain_Eg3_VS6_JH_V6_05-01-2021"]["region_0"] = 75,
_rotation["MsBrain_Eg3_VS6_JH_V6_05-01-2021"]["region_1"] = 79,
_rotation['MsBrain_EG4_VS6library_V6_LH_04-14-21']['region_0'] = 180,
_rotation['MsBrain_EG4_VS6library_V6_LH_04-14-21']['region_1'] = 180,
_rotation['MsBrain_Eg5_VS6_JH_V6_05-16-2021']['region_0'] = 180,
_rotation['MsBrain_Eg5_VS6_JH_V6_05-16-2021']['region_1'] = 180,


_rotation["MsBrain_ZM0_VS6_JH_V6_05-15-2021"]["region_0"] = 78,
_rotation["MsBrain_ZM1_VS6_JH_V11_05-16-2021"]["region_0"] = -111,
_rotation["MsBrain_ZM2_VS6_JH_V11_05-15-2021"]["region_0"] = 5,
_rotation["MsBrain_ZM3_VS6_JH_V11_05-17-2021"]["region_0"] = 51,
_rotation["MsBrain_ZM4_VS6_JH_V11_05-11-2021"]["region_0"] = 73,
_rotation["MsBrain_ZM5.1_VS6_JH_V11_05-12-2021"]["region_0"] = -34,
_rotation["MsBrain_ZM5.2_VS6_JH_V6_05-13-2021"]["region_0"] = 63,
_rotation["MsBrain_ZM6.1_VS6_V6_JH_05-11-2021"]["region_0"] = 66,
_rotation["MsBrain_ZM7.1_VS6_V6_JH_05-12-2021"]["region_0"] = -164,
_rotation["MsBrain_ZM7.2_VS6_JH_V11_05-13-2021"]["region_0"] = -34,

_rotation["VS6_MsBrain_B3_VS6library_V10_LH_02-07-21"]["region_0"] = 4,
_rotation["VS6_MsBrain_B3_VS6library_V10_LH_02-07-21"]["region_1"] = 0,